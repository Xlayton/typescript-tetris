var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},requestAnimFrame=function(){return window.requestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}(),Point=function(){function n(n,t){this.x=n;this.y=t}return n}(),Shape=function(){function n(){this.rotation=0}return n.prototype.move=function(n,t){for(var r=[],i=0;i<this.points.length;i++)r.push(new Point(this.points[i].x+n,this.points[i].y+t));return r},n.prototype.setPos=function(n){this.points=n},n.prototype.drop=function(){return this.move(0,1)},n.prototype.moveLeft=function(){return this.move(-1,0)},n.prototype.moveRight=function(){return this.move(1,0)},n.prototype.rotate=function(){throw new Error("This method is abstract");},n}(),SquareShape=function(n){function t(t){n.call(this);this.fillColor="green";var i=t/2,r=-2;this.points=[];this.points.push(new Point(i,r));this.points.push(new Point(i+1,r));this.points.push(new Point(i,r+1));this.points.push(new Point(i+1,r+1))}return __extends(t,n),t.prototype.rotate=function(){return this.points},t}(Shape),LShape=function(n){function t(t,i){n.call(this);this.leftHanded=t;this.fillColor=t?"yellow":"white";var r=i/2,u=-2;this.points=[];this.points.push(new Point(r,u-1));this.points.push(new Point(r,u));this.points.push(new Point(r,u+1));this.points.push(new Point(r+(t?-1:1),u+1))}return __extends(t,n),t.prototype.rotate=function(n){this.rotation=(this.rotation+(n?1:-1))%4;var t=[];switch(this.rotation){case 0:t.push(new Point(this.points[1].x,this.points[1].y-1));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y+1));t.push(new Point(this.points[1].x+(this.leftHanded?-1:1),this.points[1].y+1));break;case 1:t.push(new Point(this.points[1].x+1,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x-1,this.points[1].y));t.push(new Point(this.points[1].x-1,this.points[1].y+(this.leftHanded?-1:1)));break;case 2:t.push(new Point(this.points[1].x,this.points[1].y+1));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y-1));t.push(new Point(this.points[1].x+(this.leftHanded?1:-1),this.points[1].y-1));break;case 3:t.push(new Point(this.points[1].x-1,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x+1,this.points[1].y));t.push(new Point(this.points[1].x+1,this.points[1].y+(this.leftHanded?1:-1)))}return t},t}(Shape),StepShape=function(n){function t(t,i){n.call(this);this.fillColor=t?"cyan":"magenta";this.leftHanded=t;var r=i/2,u=-1;this.points=[];this.points.push(new Point(r+(t?1:-1),u));this.points.push(new Point(r,u));this.points.push(new Point(r,u-1));this.points.push(new Point(r+(t?-1:1),u-1))}return __extends(t,n),t.prototype.rotate=function(n){this.rotation=(this.rotation+(n?1:-1))%2;var t=[];switch(this.rotation){case 0:t.push(new Point(this.points[1].x+(this.leftHanded?1:-1),this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y-1));t.push(new Point(this.points[1].x+(this.leftHanded?-1:1),this.points[1].y-1));break;case 1:t.push(new Point(this.points[1].x,this.points[1].y+(this.leftHanded?1:-1)));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x+1,this.points[1].y));t.push(new Point(this.points[1].x+1,this.points[1].y+(this.leftHanded?-1:1)))}return t},t}(Shape),StraightShape=function(n){function t(t){n.call(this);this.fillColor="blue";var i=t/2,r=-2;this.points=[];this.points.push(new Point(i,r-2));this.points.push(new Point(i,r-1));this.points.push(new Point(i,r));this.points.push(new Point(i,r+1))}return __extends(t,n),t.prototype.rotate=function(n){this.rotation=(this.rotation+(n?1:-1))%2;var t=[];switch(this.rotation){case 0:t[0]=new Point(this.points[2].x,this.points[2].y-2);t[1]=new Point(this.points[2].x,this.points[2].y-1);t[2]=new Point(this.points[2].x,this.points[2].y);t[3]=new Point(this.points[2].x,this.points[2].y+1);break;case 1:t[0]=new Point(this.points[2].x+2,this.points[2].y);t[1]=new Point(this.points[2].x+1,this.points[2].y);t[2]=new Point(this.points[2].x,this.points[2].y);t[3]=new Point(this.points[2].x-1,this.points[2].y)}return t},t}(Shape),TShape=function(n){function t(t){n.call(this);this.fillColor="red";this.points=[];var i=t/2,r=-2;this.points.push(new Point(i-1,r));this.points.push(new Point(i,r));this.points.push(new Point(i+1,r));this.points.push(new Point(i,r+1))}return __extends(t,n),t.prototype.rotate=function(n){this.rotation=(this.rotation+(n?1:-1))%4;var t=[];switch(this.rotation){case 0:t.push(new Point(this.points[1].x-1,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x+1,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y+1));break;case 1:t.push(new Point(this.points[1].x,this.points[1].y-1));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y+1));t.push(new Point(this.points[1].x-1,this.points[1].y));break;case 2:t.push(new Point(this.points[1].x+1,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x-1,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y-1));break;case 3:t.push(new Point(this.points[1].x,this.points[1].y+1));t.push(new Point(this.points[1].x,this.points[1].y));t.push(new Point(this.points[1].x,this.points[1].y-1));t.push(new Point(this.points[1].x+1,this.points[1].y))}return t},t}(Shape),Grid=function(){function n(n,t,i,r,u){this.canvas=u;this.context=u.getContext("2d");this.blockSize=i;this.blockColor=new Array(n);this.backColor=r;this.cols=t;this.rows=n;for(var f=0;f<n;f++)this.blockColor[f]=new Array(t);this.xOffset=20;this.yOffset=20}return n.prototype.draw=function(n){this.paintShape(n,n.fillColor)},n.prototype.erase=function(n){this.paintShape(n,this.backColor)},n.prototype.paintShape=function(n,t){var i=this;n.points.forEach(function(n){return i.paintSquare(n.y,n.x,t)})},n.prototype.getPreferredSize=function(){return new Point(this.blockSize*this.cols,this.blockSize*this.rows)},n.prototype.isPosValid=function(n){for(var i=!0,t=0;t<n.length;t++){if(n[t].x<0||n[t].x>=this.cols||n[t].y>=this.rows){i=!1;break}if(n[t].y>=0&&this.blockColor[n[t].y][n[t].x]!=this.backColor){i=!1;break}}return i},n.prototype.addShape=function(n){for(var t=0;t<n.points.length;t++){if(n.points[t].y<0)return!1;this.blockColor[n.points[t].y][n.points[t].x]=n.fillColor}return!0},n.prototype.eraseGrid=function(){this.context.fillStyle=this.backColor;var n=this.cols*this.blockSize,t=this.rows*this.blockSize;this.context.fillRect(this.xOffset,this.yOffset,n,t)},n.prototype.clearGrid=function(){for(var t,n=0;n<this.rows;n++)for(t=0;t<this.cols;t++)this.blockColor[n][t]=this.backColor;this.eraseGrid()},n.prototype.paintSquare=function(n,t,i){n>=0&&(this.context.fillStyle=i,this.context.fillRect(this.xOffset+t*this.blockSize,this.yOffset+n*this.blockSize,this.blockSize-1,this.blockSize-1))},n.prototype.drawGrid=function(){for(var t,n=0;n<this.rows;n++)for(t=0;t<this.cols;t++)this.blockColor[n][t]!==this.backColor&&this.paintSquare(n,t,this.blockColor[n][t])},n.prototype.paint=function(){this.eraseGrid();this.drawGrid()},n.prototype.checkRows=function(n){for(var t,f,i=n.points[0].y,r=n.points[0].y,e,o=0,u=1;u<n.points.length;u++)n.points[u].y<i&&(i=n.points[u].y),n.points[u].y>r&&(r=n.points[u].y);for(i<0&&(i=0);r>=i;){for(e=!0,t=0;t<this.cols;t++)if(this.blockColor[r][t]==this.backColor){e=!1;break}if(e){for(o++,f=r;f>=0;f--)for(t=0;t<this.cols;t++)this.blockColor[f][t]=f>0?this.blockColor[f-1][t]:this.backColor;i++}else r--}return o>0&&(this.eraseGrid(),this.paint()),o},n}(),Game=function(){function n(){this.running=!1;this.phase=n.gameState.initial;this.scoreLabel=document.getElementById("scoreLabel");this.rowsLabel=document.getElementById("rowsLabel");this.levelLabel=document.getElementById("levelLabel");this.messageLabel=document.getElementById("floatingMessage");this.canvas=document.getElementById("gameCanvas");this.context=this.canvas.getContext("2d");this.grid=new Grid(16,10,20,"gray",this.canvas);this.grid.eraseGrid();this.speed=1e3;var t=this;document.onkeydown=function(n){t.keyhandler(n)};this.showMessage("Press F2 to start")}return n.prototype.draw=function(){this.phase==n.gameState.playing&&(this.grid.paint(),this.grid.draw(this.currentShape),requestAnimFrame(function(n){return function(){n.draw()}}(this)))},n.prototype.newGame=function(){this.messageLabel.style.display="none";this.grid.clearGrid();this.currentShape=this.newShape();this.score=0;this.rowsCompleted=0;this.score=0;this.level=-1;this.incrementLevel();this.updateLabels();this.phase=n.gameState.playing;requestAnimFrame(function(n){return function(){n.draw()}}(this))},n.prototype.updateLabels=function(){this.scoreLabel.innerText=this.score.toString();this.rowsLabel.innerText=this.rowsCompleted.toString();this.levelLabel.innerText=this.level.toString()},n.prototype.gameTimer=function(){if(this.phase==n.gameState.playing){var t=this.currentShape.drop();this.grid.isPosValid(t)?this.currentShape.setPos(t):this.shapeFinished()}},n.prototype.keyhandler=function(t){var i;if(this.phase==n.gameState.playing){switch(t.keyCode){case 39:i=this.currentShape.moveRight();break;case 37:i=this.currentShape.moveLeft();break;case 38:i=this.currentShape.rotate(!0);break;case 40:for(i=this.currentShape.drop();this.grid.isPosValid(i);)this.currentShape.setPos(i),i=this.currentShape.drop();this.shapeFinished()}switch(t.keyCode){case 39:case 37:case 38:this.grid.isPosValid(i)&&this.currentShape.setPos(i)}}t.keyCode==113?(this.newGame(),this.timerToken=setInterval(function(n){return function(){n.gameTimer()}}(this),this.speed)):t.keyCode==80?this.togglePause():t.keyCode==115&&(this.level<10&&this.phase==n.gameState.playing||this.phase==n.gameState.paused)&&(this.incrementLevel(),this.updateLabels())},n.prototype.togglePause=function(){this.phase==n.gameState.paused?(this.messageLabel.style.display="none",this.phase=n.gameState.playing,this.draw()):this.phase==n.gameState.playing&&(this.phase=n.gameState.paused,this.showMessage("PAUSED"))},n.prototype.showMessage=function(n){this.messageLabel.style.display="block";this.messageLabel.innerText=n},n.prototype.incrementLevel=function(){this.level++;this.level<10&&(this.speed=1e3-this.level*100,clearTimeout(this.timerToken),this.timerToken=setInterval(function(n){return function(){n.gameTimer()}}(this),this.speed))},n.prototype.shapeFinished=function(){if(this.grid.addShape(this.currentShape)){this.grid.draw(this.currentShape);var t=this.grid.checkRows(this.currentShape);this.rowsCompleted+=t;this.score+=t*(this.level+1)*10;this.rowsCompleted>(this.level+1)*10&&this.incrementLevel();this.updateLabels();this.currentShape=this.newShape()}else window.console&&console.log("Game over"),this.phase=n.gameState.gameover,this.showMessage("GAME OVER"),clearTimeout(this.timerToken)},n.prototype.newShape=function(){var t=Math.floor(Math.random()*7),n;switch(t){case 0:n=new LShape(!1,this.grid.cols);break;case 1:n=new LShape(!0,this.grid.cols);break;case 2:n=new TShape(this.grid.cols);break;case 3:n=new StepShape(!1,this.grid.cols);break;case 4:n=new StepShape(!0,this.grid.cols);break;case 5:n=new SquareShape(this.grid.cols);break;case 6:n=new StraightShape(this.grid.cols)}return n},n.gameState={initial:0,playing:1,paused:2,gameover:3},n}();(function(){"use strict";function n(){var n=new Game}window.addEventListener("DOMContentLoaded",n,!1)})();
/*
//# sourceMappingURL=app.min.js.map
*/